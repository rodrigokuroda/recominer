<md-content layout-fill layout="column" class="relative" role="main" ng-controller="projectController" ng-cloak="" id="popupContainer">
    <md-toolbar class="md-hue-2 md-whiteframe-z1">
        <div class="md-toolbar-tools">
            <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
            </md-button>
            <img ng-src="/img/top_logo.png" alt="Recominer Logo" />
            <h2>
                <span>Recominer</span>
            </h2>
            <span flex></span>
        </div>
    </md-toolbar>
    <md-content layout-fill flex layout="row">
        <md-sidenav layout-fill layout="column" class="md-sidenav-left md-whiteframe-z2 md-navigation-drawer" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')">
            <md-tabs md-dynamic-height md-border-bottom md-selected="tabIndex">
                <md-tab label="Projetos">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" md-scroll-shrink ng-class="{'md-hue-1':showSearchProjects}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchProjects">
                                    Projetos
                                </h3>
                                <span flex ng-if="!showSearchProjects"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchProjects()">
                                    <md-icon ng-if="!showSearchProjects" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchProjects" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchProjects">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchProject.name" placeholder="Project Name">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingProjects" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="project in projects| filter:searchProject" role="link" ng-click="getIssuesOf(project, 'ML')" ng-class="{ 'nav-active': project == activeProject }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{project.name}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
                <md-tab label="Tarefas">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" md-scroll-shrink ng-class="{'md-hue-1':showSearchIssues}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchIssues">
                                    Tarefas
                                </h3>
                                <span flex ng-if="!showSearchIssues"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchIssues()">
                                    <md-icon ng-if="!showSearchIssues" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchIssues" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchIssues">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchIssue.key" placeholder="Issue Key">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingIssues" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="issue in issues| filter:searchIssue" role="link" ng-click="getCommitsOf(issue, 'ML')" ng-class="{ 'nav-active': issue == activeIssue }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{issue.key}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
                <md-tab label="Commits" ng-if="false">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" md-scroll-shrink ng-class="{'md-hue-1':showSearchCommits}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchCommits">
                                    Commits
                                </h3>
                                <span flex ng-if="!showSearchCommits"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchCommits()">
                                    <md-icon ng-if="!showSearchCommits" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchCommits" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchCommits">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchCommit.revision" placeholder="Commit Revision">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingCommits" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="commit in commits| filter:searchCommit" role="link" ng-click="getFilesOf(commit)" ng-class="{ 'nav-active': commit == activeCommit }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{commit.revision}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
                <md-tab label="Files" ng-if="false">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" ng-class="{'md-hue-1':showSearchFiles}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchFiles">
                                    Files
                                </h3>
                                <span flex ng-if="!showSearchFiles"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchFiles()">
                                    <md-icon ng-if="!showSearchFiles" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchFiles" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchFiles">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchFile.name" placeholder="File Name">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingFiles" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="file in files| filter:searchFile" role="link" ng-click="getPredictedCochangesOf(file)" ng-class="{ 'nav-active': file == activeFile }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{file.name}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
            </md-tabs>
        </md-sidenav>
        <md-content layout="column" layout-fill>
            <div class="inset" hide-sm></div>
            <div layout-gt-sm="row" layout-align="center stretch">
                <div flex-gt-sm="100" flex-gt-lg="95">
                    <md-toolbar class="animate-show md-whiteframe-z1" ng-show="!editApp">
                        <md-list-item class="md-3-line">
                            <md-icon class="md-avatar" hide-sm md-svg-icon="{{'communication:ic_live_help_24px'}}"></md-icon>
                            <div class="md-list-item-text">
                                <div ng-if="activeFile != null && activeIssue != null && activeProject != null" class="md-body-1">Dado que o arquivo <b>{{activeFile.name}}</b> foi modificado para corrigir a tarefa <b>{{activeIssue.key}}</b> do projeto <b>{{activeProject.name}}</b>,
                                  os arquivos que provavelmente mudariam para completar essa tarefa foram preditos e são apresentados abaixo. <br/>
                                  Quais desses arquivos preditos você mudaria para completar a tarefa <b>{{activeIssue.key}}</b>, dado a descrição?
                                  <md-button ng-if="activeFile != null && activeIssue != null && activeProject != null" class="md-secondary md-raised" ng-click="showAlert($event)">DESCRIÇÃO</md-button>
                                  <br/>
                                </div>
                                <div ng-if="activeFile == null && activeIssue == null && activeProject == null" class="md-body-1">Por favor, selecione um projeto</div>
                              <div ng-if="activeFile == null && activeIssue == null && activeProject != null" class="md-body-1">Por favor, selecione uma tarefa</div>
                            </div>
                        </md-list-item>
                    </md-toolbar>
                    <div ng-if="loadingCochanges" layout="row" layout-sm="column" layout-align="space-around center">
                        <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                    </div>
                    <md-list>
                      <md-list-item class="md-3-line" ng-repeat="cochange in cochanges track by $index">
                        <div class="md-list-item-text">
                          <span class="md-body-1"><b>{{ cochange.file.name }}</b></span><br/>
                          <span class="md-body-1" md-colors="{color: cochange.predictionResult == 'C' ? 'green' : 'red'}">
                              A probabilidade desse arquivo {{cochange.predictionResult == 'C' ? 'mudar' : 'não mudar'}} é de {{cochange.probability | number:2}}%.
                          </span>
                          <div layout="row" layout-align="start end">
                            <md-checkbox ng-model="cochange.feedback.changed">
                              Marque se você mudaria esse arquivo para completar essa tarefa
                            </md-checkbox>
                          </div>
                        </div>
                        <md-divider ng-if="!$last"></md-divider>
                      </md-list-item>
                    </md-list>
                    <md-card ng-if="activeIssue != null && cochanges != null && cochanges.length > 0">
                        <md-card-header>
                            <md-card-header-text>
                                <div layout="row" layout-align="start end">
                                  <md-input-container class="md-block" flex="80">
                                      <label>Justifique a escolha dos arquivos que você mudaria ou não para completar a tarefa {{activeIssue.key}}.</label>
                                      <textarea ng-disabled="submiting" ng-model="activeIssue.feedback.justification" rows="3">
                                      </textarea>
                                  </md-input-container>
                                  <md-input-container class="md-block" flex="10">
                                    <md-button type="button" class="md-raised md-primary" ng-disabled="submitting" ng-click="submitMlFeedback()" ng-dblclick="return false">
                                      <div ng-if="submitting" layout="row" layout-sm="column" layout-align="space-around center">
                                        <md-progress-circular class="md-accent md-hue-1" md-diameter="25"></md-progress-circular>
                                      </div>
                                      <md-icon md-svg-icon="content:ic_send_24px"></md-icon>
                                      Enviar
                                    </md-button>
                                  </md-input-container>
                                </div>
                            </md-card-header-text>
                        </md-card-header>
                    </md-card>
                </div>
            </div>
        </md-content>
    </md-content>
</md-content>
