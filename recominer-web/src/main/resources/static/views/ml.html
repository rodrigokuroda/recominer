<md-content layout-fill layout="column" class="relative" role="main" ng-controller="projectController">
    <md-toolbar class="md-hue-2 md-whiteframe-z1">
        <div class="md-toolbar-tools">
            <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
            </md-button>
            <img ng-src="/img/top_logo.png" alt="Recominer Logo" />
            <h2>
                <span>Recominer</span>
            </h2>
            <span flex></span>
        </div>
    </md-toolbar>
    <md-content layout-fill flex layout="row">
        <md-sidenav layout-fill layout="column" class="md-sidenav-left md-whiteframe-z2 md-navigation-drawer" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')">
            <md-tabs md-dynamic-height md-border-bottom md-selected="tabIndex">
                <md-tab label="Projetos">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" md-scroll-shrink ng-class="{'md-hue-1':showSearchProjects}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchProjects">
                                    Projetos
                                </h3>
                                <span flex ng-if="!showSearchProjects"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchProjects()">
                                    <md-icon ng-if="!showSearchProjects" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchProjects" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchProjects">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchProject.name" placeholder="Project Name">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingProjects" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="project in projects| filter:searchProject" role="link" ng-click="getIssuesOf(project)" ng-class="{ 'nav-active': project == activeProject }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{project.name}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
                <md-tab label="Tarefas">
                    <md-content layout-fill flex>
                        <md-toolbar class="md-whiteframe-z1" md-scroll-shrink ng-class="{'md-hue-1':showSearchIssues}">
                            <div class="md-toolbar-tools">
                                <md-button class="md-icon-button" ng-click="toggleSidenav('left')" hide-gt-md aria-label="Menu">
                                    <md-icon md-svg-icon="navigation:ic_menu_24px" aria-label="Menu"></md-icon>
                                </md-button>
                                <h3 ng-if="!showSearchIssues">
                                    Tarefas
                                </h3>
                                <span flex ng-if="!showSearchIssues"></span>
                                <md-button class="md-icon-button" aria-label="Search" ng-click="toggleSearchIssues()">
                                    <md-icon ng-if="!showSearchIssues" md-svg-icon="action:ic_search_24px" aria-label="Search"></md-icon>
                                    <md-icon ng-if="showSearchIssues" md-svg-icon="navigation:ic_arrow_back_24px" aria-label="Back"></md-icon>
                                </md-button>
                                <md-input-container md-theme="input" ng-show="showSearchIssues">
                                    <label>&nbsp;</label>
                                    <input ng-model="searchIssue.key" placeholder="Issue Key">
                                </md-input-container>
                            </div>
                        </md-toolbar>
                        <div ng-if="loadingIssues" layout="row" layout-sm="column" layout-align="space-around center">
                            <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                        </div>
                        <md-list flex>
                            <md-list-item class="md-2-line" ng-repeat="issue in issues| filter:searchIssue" role="link" ng-click="getCommitsOf(issue, 'ML')" ng-class="{ 'nav-active': issue == activeIssue }">
                                <div class="md-list-item-text">
                                    <div class="md-body-2">{{issue.key}}</div>
                                </div>
                                <md-divider></md-divider>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </md-tab>
            </md-tabs>
        </md-sidenav>
        <md-content layout="column" layout-fill>
            <div class="inset" hide-sm></div>
            <div layout-gt-sm="row" layout-align="center stretch">
                <div flex-gt-sm="100" flex-gt-lg="95">
                    <md-toolbar class="animate-show md-whiteframe-z1" ng-show="!editApp">
                        <md-list-item class="md-3-line">
                            <md-icon class="md-avatar" hide-sm md-svg-icon="{{'communication:ic_live_help_24px'}}"></md-icon>
                            <div class="md-list-item-text">
                                <div ng-if="activeFile != null && activeIssue != null && activeProject != null" class="md-body-1">Dado que o arquivo <b>{{activeFile.name}}</b> foi modificado para corrigir a tarefa <b>{{activeIssue.key}}</b> do projeto <b>{{activeProject.name}}</b>,
                                  foram preditos os arquivos que provavelmente mudariam para completar essa tarefa. <br/> Quais desses arquivos preditos você mudaria para completar a tarefa <b>{{activeIssue.key}}</b>?</div>

                                <div ng-if="activeFile == null && activeIssue == null && activeProject == null" class="md-body-1">Por favor, selecione um projeto</div>
                              <div ng-if="activeFile == null && activeIssue == null && activeProject != null" class="md-body-1">Por favor, selecione uma tarefa</div>
                            </div>
                        </md-list-item>
                    </md-toolbar>
                    <div ng-if="loadingCochanges" layout="row" layout-sm="column" layout-align="space-around center">
                        <md-progress-circular class="md-accent md-hue-1" md-diameter="50"></md-progress-circular>
                    </div>
                    <div ng-if="paginatedCochanges != null && paginatedCochanges.length > 0" layout="row" layout-sm="column" layout-align="center center" layout-margin>
                        <cl-paging flex cl-pages="paging.total" cl-steps="6" cl-page-changed="paging.onPageChanged()" cl-align="center center" cl-current-page="paging.current"></cl-paging>
                    </div>
                    <md-card ng-repeat="cochange in paginatedCochanges track by $index">
                        <md-card-header>
                            <md-card-header-text>
                                <span class="md-title">{{ cochange.file.name }}</span>
                                <span class="md-title">
                                  <md-icon
                                      md-colors="{color: cochange.predictionResult == 'C' ? 'green' : 'red'}"
                                      md-svg-icon="{{cochange.predictionResult == 'C' ? 'action:ic_done_24px' : 'content:ic_clear_24px'}}"></md-icon>
                                    A probabilidade desse arquivo {{cochange.predictionResult == 'C' ? 'mudar' : 'não mudar'}} é de {{cochange.probability | number:2}}%.
                                </span>
                                <div layout="row" layout-align="start end">
                                  <md-checkbox ng-model="cochange.feedback.changed">
                                    Marque se você mudaria esse arquivo para completar essa tarefa
                                  </md-checkbox>
                                </div>
                            </md-card-header-text>
                        </md-card-header>
                    </md-card>
                    <div ng-if="paginatedCochanges != null && paginatedCochanges.length > 0" layout="row" layout-sm="column" layout-align="center center" layout-margin>
                        <cl-paging flex cl-pages="paging.total" cl-steps="6" cl-page-changed="paging.onPageChanged()" cl-align="center center" cl-current-page="paging.current"></cl-paging>
                    </div>
                    <md-card ng-if="paginatedCochanges != null && paginatedCochanges.length > 0">
                        <md-card-header>
                            <md-card-header-text>
                                <div layout="row" layout-align="start end">
                                  <md-input-container class="md-block" flex="80">
                                      <label>Justifique suas escolhas dos arquivos que você decidiu mudar ou não.</label>
                                      <textarea ng-model="cochange.feedback.justification" required md-maxlength="4096" rows="3">
                                      </textarea>
                                  </md-input-container>
                                  <md-input-container class="md-block" flex="10">
                                    <md-button type="button" class="md-raised md-primary" ng-click="submitFeedback(cochange)">
                                      <md-icon md-svg-icon="content:ic_send_24px"></md-icon>
                                      Enviar
                                    </md-button>
                                  </md-input-container>
                                </div>
                            </md-card-header-text>
                        </md-card-header>
                    </md-card>
                </div>
            </div>
        </md-content>
    </md-content>
</md-content>
